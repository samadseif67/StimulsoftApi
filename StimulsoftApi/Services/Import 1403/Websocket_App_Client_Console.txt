using System.Net.WebSockets;
using System.Text;
using static System.Net.Mime.MediaTypeNames;

class Program
{
    static async Task Main(string[] args)
    {
        var ws = new ClientWebSocket();
        try
        {
            await ws.ConnectAsync(new Uri("ws://localhost:5000/ws"), CancellationToken.None);
            Console.WriteLine("connected. type a msg (exit to quit):");

            _ = ReciveLoop(ws);

            string? line;
            while ((line = Console.ReadLine()) != "exit")
            {
                if (!string.IsNullOrWhiteSpace(line))
                {
                    var bytes = Encoding.UTF8.GetBytes(line);
                    await ws.SendAsync(bytes, WebSocketMessageType.Text, true, CancellationToken.None);
                }
            }
        }
        catch (Exception ex)
        {
            throw;
        }
        finally
        {
            if (ws.State == WebSocketState.Open)
            {
                await ws.CloseAsync(WebSocketCloseStatus.NormalClosure, "bye", CancellationToken.None);
            }
        }         
    }

    static async Task ReciveLoop(ClientWebSocket ws)
    {
        var buf = new byte[1024];
        while (ws.State == WebSocketState.Open)
        {
            var res = await ws.ReceiveAsync(buf, CancellationToken.None);
            Console.WriteLine(Encoding.UTF8.GetString(buf, 0, res.Count));

        }
    }

}




 

